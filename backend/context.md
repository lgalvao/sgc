# OpenAPI Specification Validation Tests - Unresolved Issues

## Goal
The primary goal was to add automated tests to validate the OpenAPI specification generated by SpringDoc.

## Work Completed
1.  **Dependencies Added**: The following test dependencies were added to `backend/build.gradle.kts`:
    *   `io.swagger.parser.v3:swagger-parser:2.1.35`
    *   `com.atlassian.oai:swagger-request-validator-mockmvc:2.46.0`
2.  **Validation Test Created**: A test class `sgc.openapi.OpenApiValidationTest` was created to perform a basic validation of the OpenAPI specification. The test attempts to fetch the spec from the `/api-docs` endpoint and parse it to ensure it's well-formed.

## Unresolved Problem
The `OpenApiValidationTest` consistently fails with an HTTP 500 Internal Server Error when making a request to the `/api-docs` endpoint. The final test failure output was:

```
====================
RESUMO DOS TESTES
====================

Situacao: FALHA
Total:    1
Sucesso:  0
Falhas:   1
Ignorados: 0
Tempo:  10.69s

--------------------
TESTES QUE FALHARAM (1)
--------------------

1. sgc.openapi.OpenApiValidationTest
   Método: deveGerarEspecificacaoOpenApiValida()
   Erro: [PlaceholderAssertionError] [O status da requisição para a especificação OpenAPI deve ser 200 OK]
expected: 200
 but was: 500
   Stack trace relevante:
       sgc.openapi.OpenApiValidationTest.deveGerarEspecificacaoOpenApiValida(OpenApiValidationTest.java:62)
```

## Debugging Steps and Challenges
A significant amount of time was spent trying to diagnose the root cause of the 500 error, but these attempts were unsuccessful due to limitations in the test environment.

1.  **Initial Failures (401 & 404)**: The test initially failed with 401 Unauthorized and 404 Not Found errors. These were resolved by:
    *   Adding `@WithMockUser` and `@Import(TestSecurityConfig.class)` to handle security.
    *   Correcting the endpoint URL to `/api-docs` as specified in `application.yml`.
    *   Adding `@ActiveProfiles("test")` to ensure the correct test application properties (using an H2 database) were loaded.

2.  **The 500 Error**: After fixing the initial issues, the test started failing with a persistent 500 Internal Server Error, indicating a problem during the generation of the OpenAPI specification itself.

3.  **Inability to Inspect Error Response**: The primary blocker for further diagnosis was the inability to inspect the body of the 500 error response. The following methods were attempted without success, as the test environment's output did not include the response body:
    *   Printing the response body to `System.out` and `System.err`.
    *   Using an SLF4J logger.
    *   Using MockMvc's `.andDo(print())` method.
    *   Redirecting the entire Gradle test output to a log file.

4.  **Isolated Test Application**: An attempt was made to create a minimal, isolated Spring Boot application within the test sources to confirm that the basic dependencies could generate a spec. This experiment was also inconclusive and ultimately abandoned to avoid adding unnecessary complexity.

## Conclusion
The root cause of the 500 error remains unknown because the error response body cannot be inspected. The problem likely lies within the SpringDoc auto-configuration or a conflict within the application's specific test context that is triggered when the `/api-docs` endpoint is called. The current changes are being submitted so that the issue can be investigated with different tools or in a different environment. The `OpenApiValidationTest` remains in the codebase as a failing test that reproduces the issue.