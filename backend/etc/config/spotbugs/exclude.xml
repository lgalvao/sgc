<?xml version="1.0" encoding="UTF-8"?>
<FindBugsFilter>
    <!-- Pacotes e classes geradas -->
    <Match>
        <Package name="~.*\.generated\..*"/>
    </Match>

    <!-- DTOs e Entities: getters retornam coleções mutáveis (padrão JPA/DTO) -->
    <Match>
        <Or>
            <Class name="~.*\.dto\..*"/>
            <Class name="~.*\.entity\..*"/>
            <Class name="~.*\.model\..*"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- Classe principal da aplicação -->
    <Match>
        <Class name="sgc.Sgc"/>
    </Match>

    <!-- Classes geradas pelo MapStruct -->
    <Match>
        <Class name="~.*MapperImpl"/>
    </Match>

    <!-- 
        Injeção de Dependências Spring: Construtores de @Service/@Component/@Facade
        armazenam beans gerenciados pelo container. Não há risco de "exposição de 
        representação interna" pois são singletons imutáveis após injeção.
    -->
    <Match>
        <Or>
            <Class name="sgc.mapa.MapaFacade"/>
            <Class name="sgc.mapa.AtividadeFacade"/>
            <Class name="sgc.subprocesso.service.crud.SubprocessoCrudService"/>
            <Class name="sgc.subprocesso.service.SubprocessoWorkflowService"/>
            <Class name="sgc.processo.service.ProcessoConsultaService"/>
            <Class name="sgc.seguranca.LoginFacade"/>
            <Class name="sgc.e2e.E2eController"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>

    <!-- 
        Records de Configuration Properties: Spring Boot injeta valores de configuração.
        Os valores são efetivamente imutáveis após startup.
    -->
    <Match>
        <Class name="sgc.seguranca.config.ConfigCorsProperties"/>
        <Bug pattern="EI_EXPOSE_REP"/>
    </Match>

    <!-- 
        Classe de exceção que armazena causa (DocumentException).
        O padrão de exceção com causa é intencional para stack trace.
    -->
    <Match>
        <Class name="sgc.relatorio.ErroRelatorio"/>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>

    <!--
        Setter de auto-injeção para chamadas @Transactional via proxy.
        Padrão comum em Spring para contornar limitação de self-invocation.
    -->
    <Match>
        <Class name="sgc.subprocesso.service.SubprocessoWorkflowService"/>
        <Method name="setSelf"/>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>

    <!-- 
        ===== EXCLUSÕES PARA TESTES ===== 
    -->

    <!--
        Exceções ignoradas em métodos setUp de testes de integração.
        Padrão comum para resetar sequências de banco em testes.
    -->
    <Match>
        <Or>
            <Class name="~sgc\.integracao\..*IntegrationTest"/>
        </Or>
        <Method name="~setUp|lambda\$setupSecurityContext\$.*"/>
        <Bug pattern="DE_MIGHT_IGNORE"/>
    </Match>

    <!--
        Variáveis não usadas em testes unitários.
        Comum em testes de fixture onde o retorno não precisa ser verificado.
    -->
    <Match>
        <Or>
            <Class name="~sgc\..*Test\$.*"/>
            <Class name="~sgc\..*Test"/>
        </Or>
        <Bug pattern="UC_USELESS_OBJECT,RV_RETURN_VALUE_IGNORED_NO_SIDE_EFFECT"/>
    </Match>

    <!--
        Mocks não precisam ser fechados.
    -->
    <Match>
        <Class name="~sgc\..*Test"/>
        <Bug pattern="OBL_UNSATISFIED_OBLIGATION"/>
    </Match>
</FindBugsFilter>